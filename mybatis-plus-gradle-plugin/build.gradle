/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Gradle plugin project to get you started.
 * For more details take a look at the Writing Custom Plugins chapter in the Gradle
 * User Manual available at https://docs.gradle.org/8.1.1/userguide/custom_plugins.html
 */

plugins {
    // Apply the Java Gradle plugin development plugin to add support for developing Gradle plugins
    id 'groovy-gradle-plugin'

    id 'maven-publish'
//    id "com.gradle.plugin-publish" version "0.15.0"

}

group = GROUP
version = VERSION


repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}

dependencies {
//    implementation gradleApi()
    // Use JUnit Jupiter for testing.


//    implementation(libs.mybatisPlus)

    implementation("com.baomidou:mybatis-plus:3.5.3.1")

//    implementation(libs.mybatisPlusGenerator)
    implementation("com.baomidou:mybatis-plus-generator:3.5.3.1")

//    implementation(libs.hikariCP)
    implementation("com.zaxxer:HikariCP:5.0.1")

//    implementation(libs.postgresql)
//    implementation("org.postgresql:postgresql:42.6.0")

//    implementation(libs.snakeYaml)
    implementation("org.yaml:snakeyaml:2.0")

//    implementation(libs.freekmarker)
    implementation("org.freemarker:freemarker:2.3.32")

//    implementation(libs.groovy)
//    implementation("org.apache.groovy:groovy-all:3.0.15")
//    implementation 'org.codehaus.groovy:groovy:3.0.15'

//    implementation(libs.logbackClassic)
    implementation("ch.qos.logback:logback-classic:1.4.7")

//    compileOnly(libs.lombok)
    compileOnly("org.projectlombok:lombok:1.18.28")

//    annotationProcessor(libs.lombok)
    annotationProcessor("org.projectlombok:lombok:1.18.28")

    // Use JUnit Jupiter API for testing.
//    testImplementation(libs.junitJupiterApi)
    testImplementation("org.junit.jupiter:junit-jupiter-api:5.9.3")

    // Use JUnit Jupiter Engine for testing.
//    testRuntimeOnly(libs.junitJupiterEngine)
    testRuntimeOnly("org.junit.jupiter:junit-jupiter-engine:5.9.3")

    // Use JUnit Jupiter Params for testing.
//    testImplementation(libs.spockCore)
    testImplementation 'org.spockframework:spock-core:2.3-groovy-3.0'

}

gradlePlugin {
    // Define the plugin
    plugins {
        mybatisPlusGradlePlugin {
            id = 'com.github.fengshch.mybatis-plus-gradle-plugin'
            implementationClass = 'com.github.fengshch.mybatis.MyBatisPlusGradlePlugin'
        }
    }
}

// Add a source set for the functional test suite
sourceSets {
    functionalTest {
    }
}

configurations.functionalTestImplementation.extendsFrom(configurations.testImplementation)

// Add a task to run the functional tests
tasks.register('functionalTest', Test) {
    testClassesDirs = sourceSets.functionalTest.output.classesDirs
    classpath = sourceSets.functionalTest.runtimeClasspath
    useJUnitPlatform()
}

gradlePlugin.testSourceSets.add(sourceSets.functionalTest)

tasks.named('check') {
    // Run the functional tests as part of `check`
    dependsOn(tasks.functionalTest)
}

tasks.named('test') {
    // Use JUnit Jupiter for unit tests.
    useJUnitPlatform()
}
